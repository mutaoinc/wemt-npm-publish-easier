# 开发规则与约定

## 环境与工具

- **操作系统**: Windows 环境，所有命令行操作使用 PowerShell 语法
- **Node.js**: 最低版本 16.0.0，使用 ES6 模块 (type: "module")
- **包管理器**: 使用 npm，支持 npm publish 工作流

## 代码风格与语言规范

### 交流语言
- 所有回答和说明使用中文
- 代码注释必须使用中文，提高可读性
- 调试输出信息（console，print等）使用英文

### JavaScript 代码规范
- 使用 ES6+ 语法，import/export 模块系统
- 优先使用 const，需要重新赋值时使用 let，避免 var
- 使用模板字符串而非字符串拼接
- 异步操作优先使用 async/await，避免回调地狱
- 错误处理使用 try-catch 包装，提供有意义的错误信息

### 文件和目录结构
- 源代码放在 `src/` 目录
- 构建输出放在 `publish/` 目录
- 配置文件放在项目根目录
- 测试文件放在 `test/` 目录

## 开发行为约定

### 基本原则
- **不提供运行命令**，除非用户询问
- **配置驱动**，减少使用硬编码，所有配置通过 `publish.config.js` 管理
- 专注于代码实现和问题解决
- 优先提供最小化、可工作的代码示例

### 错误处理
- 所有可能失败的操作都要有错误处理
- 错误信息要清晰明确，帮助用户快速定位问题
- 使用 emoji 图标增强控制台输出的可读性
- 区分警告 (⚠️) 和错误 (❌) 信息

### 用户体验
- 提供详细的进度反馈，让用户了解当前执行状态
- 重要操作前给出清晰的提示信息
- 支持 `--help` 参数显示使用说明
- 配置文件不存在时，引导用户使用 `--init` 创建

## 技术栈特定规范

### Node.js 文件系统操作
- 使用同步方法处理配置文件读写
- 使用异步方法处理大文件或目录复制
- 文件路径使用 `path.join()` 和 `path.resolve()` 确保跨平台兼容

### 命令行工具开发
- 使用 `process.argv` 解析命令行参数
- 使用 `execSync` 执行外部命令，配置 `stdio: "inherit"` 显示输出
- 适当的退出码：成功 0，失败 1

### 包发布流程
- 支持版本自动递增（patch 级别）
- 支持自定义构建命令
- 支持文件过滤和复制配置
- 发布前清理临时文件

## 安全和最佳实践

- 验证用户输入，防止路径遍历攻击
- 文件操作前检查文件/目录是否存在
- 敏感操作（如删除目录）提供安全检查
- 配置文件使用 JavaScript 而非 JSON，支持注释和复杂逻辑